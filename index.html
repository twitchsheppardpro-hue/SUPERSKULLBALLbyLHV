<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Super Skullball by LHV</title>

  <!-- Désactive au maximum le cache côté navigateur -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    :root{
      --bg:#0f1318;
      --panel:#111823;
      --panel2:#0d1420;
      --text:#e6edf3;
      --muted:#9fb0c6;
      --chip:#1b2635;
      --accent:#94c6ff;
      --ok:#35c759;
      --ring:#1b2536;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:1200px;margin:0 auto;padding:24px}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--ring);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .nav{display:flex;gap:12px;margin-bottom:16px}
    .pill{background:#0b1220;border:1px solid var(--ring);border-radius:12px;padding:10px 14px;color:#cdd7e5}
    .top{display:flex;align-items:center;gap:18px;padding:20px}
    .top img{width:96px;height:96px;border-radius:12px;object-fit:contain;background:#0d1320;border:1px solid var(--ring)}
    h1{margin:0;font-size:28px;letter-spacing:.3px}
    h2{margin:0 0 12px 0;font-size:20px}
    /* table classement */
    table{width:100%;border-collapse:collapse;overflow:hidden;border-radius:12px}
    thead th{font-weight:600;color:#b8c7dc;background:#111a27;border-bottom:1px solid #1a2534;padding:10px 12px;text-align:left}
    tbody td{border-bottom:1px solid #142034;padding:10px 12px;vertical-align:middle}
    tbody tr:hover{background:#0e1622}
    .teamcell{display:flex;align-items:center;gap:10px}
    .logo{width:28px;height:28px;border-radius:8px;object-fit:contain;background:#0d1420;border:1px solid var(--ring)}
    /* grille équipes */
    .grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:14px}
    @media (max-width:960px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    .card-team{padding:14px}
    .card-team .row1{display:flex;align-items:center;gap:10px;margin-bottom:8px}
    .chip{display:inline-block;background:var(--chip);border:1px solid #1c2b3f;color:#bcd0ea;padding:4px 8px;border-radius:999px;font-size:12px;margin-right:6px;margin-top:6px}
    .muted{color:var(--muted)}
    .right{display:flex;gap:10px;align-items:center;margin-left:auto}
    .btn{background:#0c1524;border:1px solid #1a2738;color:#cfe0f7;border-radius:10px;padding:8px 12px;cursor:pointer}
    .btn:hover{background:#0e192a}
    .ok{color:var(--ok)}

    /* Coupe tout éventuel "nom en fond" fantôme dans le classement */
    #classement .team-name::after,
    #classement .team-cell::after,
    #classement .bg-team-name,
    #classement .team-bg,
    .table-standings .team-name::after,
    .table-standings .team::after,
    .ranking-table .team-name::after,
    .ranking-table .team::after {
      content:none !important;
      display:none !important;
      opacity:0 !important;
      visibility:hidden !important;
      text-shadow:none !important;
      filter:none !important;
    }
  </style>
</head>
<body>
<div class="wrap">

  <div class="nav">
    <span class="pill">Classement</span>
    <span class="pill">Phase finale</span>
    <span class="pill">Matchs en direct</span>
    <span class="pill">Matchs terminés</span>
    <span class="pill">Gestion</span>
  </div>

  <div class="card top" id="header">
    <img id="leagueLogo" alt="logo ligue" />
    <div>
      <h1 id="leagueName">Ma Ligue</h1>
      <div class="muted">Prévisualisation publique — chargée depuis <code>data/teams.json</code></div>
    </div>
    <div class="right">
      <button class="btn" id="refreshBtn" title="Force un rechargement sans cache">Recharger (no‑cache)</button>
    </div>
  </div>

  <div class="card" style="padding:16px;margin-top:16px">
    <h2>Classement (démo visuelle)</h2>
    <div class="muted" style="margin:-6px 0 10px 0">Tri alphabétique (pas de points tant qu'il n'y a pas de matchs).</div>
    <table id="table">
      <thead>
        <tr>
          <th style="width:40px">#</th>
          <th>Équipe</th>
          <th style="width:60px">J</th>
          <th style="width:60px">Pts</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="card" style="padding:16px;margin-top:16px">
    <h2>Équipes (lecture seule)</h2>
    <div id="teams" class="grid"></div>
  </div>

</div>

<script>
(function(){
  // --------- Anti-cache robuste ---------
  const VERSION = Date.now(); // change automatiquement à chaque chargement
  const BASE = (new URL('.', location.href)).href;

  function bust(url){
    const u = new URL(url, BASE);
    u.searchParams.set('v', VERSION);
    return u.href;
  }

  async function getJsonNoCache(url){
    const u = bust(url);
    const r = await fetch(u, { cache:'no-store', headers:{ 'Cache-Control':'no-store' } });
    if(!r.ok) throw new Error('HTTP '+r.status);
    return await r.json();
  }

  function setHeader(data){
    const name = data.leagueName || 'Ma Ligue';
    const logo = data.eventLogo || '';
    document.getElementById('leagueName').textContent = name;
    const img = document.getElementById('leagueLogo');
    if(logo){ img.src = bust(logo); } else { img.remove(); }
  }

  function renderTable(teams){
    const tbody = document.querySelector('#table tbody');
    tbody.innerHTML = '';
    const sorted = [...teams].sort((a,b)=>a.name.localeCompare(b.name,'fr'));
    sorted.forEach((t,idx)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${idx+1}</td>
        <td class="teamcell">
          <img class="logo" src="${bust(t.logo||'')}" alt="logo" />
          <span>${t.name}</span>
        </td>
        <td>0</td>
        <td>0</td>`;
      tbody.appendChild(tr);
    });
  }

  function renderCards(teams){
    const host = document.getElementById('teams');
    host.innerHTML = '';
    teams.forEach(t=>{
      const d = document.createElement('div');
      d.className = 'card-team card';
      d.innerHTML = `
        <div class="row1">
          <img class="logo" src="${bust(t.logo||'')}" alt="logo" />
          <div>
            <div style="font-weight:600">${t.name}</div>
            <div class="muted" style="font-size:12px">${t.color || '#202532'}</div>
          </div>
        </div>
        <div>${(t.players||[]).map(p=>`<span class="chip">${p}</span>`).join('')}</div>`;
      host.appendChild(d);
    });
  }

  async function boot(){
    try{
      const data = await getJsonNoCache('data/teams.json');
      setHeader(data);
      renderTable(data.teams||[]);
      renderCards(data.teams||[]);
      console.log('%cOK','color:lime','teams.json chargé (no-cache)');
    }catch(e){
      console.error('Échec de chargement de data/teams.json', e);
      const msg = document.createElement('div');
      msg.className = 'wrap';
      msg.innerHTML = `<div class="card" style="padding:16px;color:#ffb4a5;border-color:#3a2224;background:#1a0f11">
        Impossible de charger <code>data/teams.json</code>. Vérifie le chemin et les CORS. ${e.message}
      </div>`;
      document.body.appendChild(msg);
    }
  }

  document.getElementById('refreshBtn').addEventListener('click',()=>{
    // Force un rechargement réseau
    location.href = location.pathname + '?r=' + Date.now();
  });

  // Débranche tout éventuel service worker qui aurait été enregistré par le passé
  if('serviceWorker' in navigator){
    navigator.serviceWorker.getRegistrations().then(list=>list.forEach(r=>r.unregister()));
  }

  boot();
})();
</script>
</body>
</html>
