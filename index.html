<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tournoi — Classement</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f141b;
    --panel:#121a22;
    --panel2:#0f1922;
    --muted:#9fb2c8;
    --text:#dbe7f4;
    --accent:#60a5fa;
    --chip:#1e293b;
    --line:#1b2430;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1280px;margin:0 auto;padding:24px}
  .tabs{display:flex;gap:12px;margin:8px 0 20px}
  .tab{padding:10px 16px;border-radius:10px;background:var(--panel2);border:1px solid var(--line);color:#cfe2ff}
  .tab.active{background:#17212b;border-color:#223142}
  .hero{display:flex;align-items:center;gap:16px;background:linear-gradient(180deg,#0f1922,#121a22);border:1px solid var(--line);padding:20px;border-radius:16px}
  .hero img{width:96px;height:96px;object-fit:contain;background:#0b1117;border-radius:12px;border:1px solid #1d2731}
  .title{font-size:28px;font-weight:800;letter-spacing:.4px}
  .muted{color:var(--muted);font-size:13px}
  .panel{margin-top:18px;background:var(--panel);border:1px solid var(--line);border-radius:14px;overflow:hidden}
  .panel h2{margin:0;padding:16px 18px;border-bottom:1px solid var(--line);font-size:18px}
  table{width:100%;border-collapse:collapse}
  thead th{font-weight:600;color:#c9d7e5;background:#111923;border-bottom:1px solid var(--line);padding:12px 10px;text-align:center}
  thead th:first-child{text-align:left;padding-left:18px}
  tbody td{padding:12px 10px;border-bottom:1px solid #151f2b;text-align:center}
  tbody td:first-child{text-align:left;padding-left:18px;display:flex;align-items:center;gap:10px}
  .logo{width:36px;height:36px;border-radius:8px;background:#0b1117;border:1px solid #1d2731;object-fit:contain}
  .rank{width:36px;text-align:center;opacity:.9}
  .team{font-weight:700;letter-spacing:.2px}
  .btn{background:#132033;border:1px solid #213043;padding:8px 12px;border-radius:10px;color:#cfe2ff;font-weight:600;font-size:13px}
  .topbar{display:flex;justify-content:space-between;align-items:center}
</style>
</head>
<body>
<div class="wrap">
  <div class="tabs">
    <div class="tab active">Classement</div>
    <div class="tab">Phase finale</div>
    <div class="tab">Matchs en direct</div>
    <div class="tab">Matchs terminés</div>
    <div class="tab">Gestion</div>
  </div>

  <div class="hero">
    <img id="eventLogo" alt="logo">
    <div>
      <div class="title" id="leagueName">Ma Ligue</div>
      <div class="muted">Chargé depuis <code>data/teams.json</code> — affichage public</div>
    </div>
    <div style="margin-left:auto">
      <button class="btn" id="refresh">Recharger (no‑cache)</button>
    </div>
  </div>

  <div class="panel" id="classementPanel">
    <h2>Classement</h2>
    <div style="overflow:auto">
      <table id="tableau">
        <thead>
          <tr>
            <th style="width:46px">#</th>
            <th style="text-align:left">Équipe</th>
            <th>J</th><th>G</th><th>N</th><th>P</th>
            <th>BP</th><th>BC</th><th>Diff</th>
            <th>BO</th><th>BD</th><th>Pts</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
(function(){
  const cacheBust = () => 'cb=' + Math.random().toString(36).slice(2);
  const rows = document.getElementById('rows');
  const eventLogo = document.getElementById('eventLogo');
  const leagueName = document.getElementById('leagueName');
  const refreshBtn = document.getElementById('refresh');

  function safeUrl(u){ if(!u) return ''; return u + (u.includes('?')?'&':'?') + cacheBust(); }

  async function load() {
    rows.innerHTML = '<tr><td colspan="12" style="padding:18px;text-align:center;color:#9fb2c8">Chargement…</td></tr>';
    try{
      const res = await fetch('data/teams.json?'+cacheBust(), {cache:'no-store'});
      const data = await res.json();
      leagueName.textContent = data.leagueName || 'Ma Ligue';
      eventLogo.src = safeUrl(data.eventLogo);
      eventLogo.alt = 'logo';
      renderTeams((data.teams||[]));
    }catch(e){
      console.error(e);
      rows.innerHTML = '<tr><td colspan="12" style="padding:18px;text-align:center;color:#ffaeae">Erreur de chargement des équipes</td></tr>';
    }
  }

  function renderTeams(list){
    // ordre: par id croissant (ça se rapproche de votre ancien affichage)
    list = (list||[]).slice().sort((a,b)=> (a.id||0)-(b.id||0));
    rows.innerHTML = '';
    list.forEach((t,idx)=>{
      const tr = document.createElement('tr');
      const logo = document.createElement('img');
      logo.className = 'logo';
      logo.src = safeUrl(t.logo);
      logo.alt = t.name || 'logo';

      const tdRank = document.createElement('td');
      tdRank.className = 'rank';
      tdRank.textContent = String(idx+1);

      const tdTeam = document.createElement('td');
      tdTeam.style.textAlign='left';
      tdTeam.style.display='flex'; tdTeam.style.alignItems='center'; tdTeam.style.gap='10px';
      const name = document.createElement('span'); name.className='team'; name.textContent = t.name||('equipe'+(idx+1));
      tdTeam.appendChild(logo); tdTeam.appendChild(name);

      function td(v){ const el = document.createElement('td'); el.textContent = v; return el; }

      tr.appendChild(tdRank);
      tr.appendChild(tdTeam);
      // J,G,N,P,BP,BC,Diff,BO,BD,Pts -> par défaut 0 tant qu'il n'y a pas d'historique de matchs
      tr.appendChild(td(0)); tr.appendChild(td(0)); tr.appendChild(td(0)); tr.appendChild(td(0));
      tr.appendChild(td(0)); tr.appendChild(td(0)); tr.appendChild(td(0));
      tr.appendChild(td(0)); tr.appendChild(td(0)); tr.appendChild(td(0));

      rows.appendChild(tr);
    });
  }

  refreshBtn.addEventListener('click', load);

  // Désenregistrement SW résiduels
  if('serviceWorker' in navigator){
    navigator.serviceWorker.getRegistrations?.().then(list=>{
      list.forEach(r=>r.unregister());
    }).catch(()=>{});
  }

  load();
})();
</script>
</body>
</html>
