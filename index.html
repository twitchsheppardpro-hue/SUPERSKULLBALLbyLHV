<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Skullball – V8.20</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg-dark:#0C131B;
  --panel:#111823;
  --ink:#EAF0FB;
  --muted:#9CA9BB;
  --accent:#F59E0B; /* orange active pill */
  --pill:#1B2432;
  --pill-border:#2A3647;
  --pill-hover:#222E40;
  --gold1:#D3AD6B;
  --gold2:#B18753;
  --row-sep:#1E2A3A;
  --ok:#22C55E;
  --danger:#EF4444;
}

/* Base */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  color:var(--ink);
  background:linear-gradient(135deg,#002654 0%,#002654 30%,#ffffff 50%,#CE1126 80%,#CE1126 100%);
  background-attachment:fixed;
}
.container{max-width:1280px;margin:0 auto;padding:0 16px}

/* Header — layout photo 1, graphic pills photo 2 */
header.head{
  position:sticky;top:0;z-index:100;
  padding:18px 0;
  border-bottom:1px solid rgba(255,255,255,.08);
  background:linear-gradient(90deg,rgba(0,38,84,.92) 0%,rgba(0,38,84,.75) 40%,rgba(255,255,255,.14) 60%,rgba(206,17,38,.36) 78%,rgba(206,17,38,.62) 100%);
  backdrop-filter:blur(8px);
}
.head-grid{display:grid;grid-template-columns:auto 1fr auto;gap:20px;align-items:center}
.event{
  display:flex;align-items:center;gap:16px
}
.event-logo{
  width:96px;height:96px;border-radius:14px;object-fit:cover;
  background:#0b121c;border:1px solid rgba(255,255,255,.12);
  box-shadow:0 12px 28px rgba(0,0,0,.35);
}
h1.title{margin:0;font-weight:800;font-size:28px;letter-spacing:.2px;text-shadow:0 2px 8px rgba(0,0,0,.35)}

.nav{display:flex;gap:14px;flex-wrap:wrap}
.pill{
  height:44px;display:inline-flex;align-items:center;gap:10px;
  padding:0 18px;border-radius:16px;
  background:var(--pill);
  border:1px solid var(--pill-border);
  color:var(--ink);font-weight:700;cursor:pointer;user-select:none;
  transition:transform .06s ease, background .15s ease, color .15s ease, border-color .15s ease;
}
.pill:hover{background:var(--pill-hover);transform:translateY(-1px)}
.pill.active{background:var(--accent);color:#2A1800;border-color:transparent}
.admin{justify-self:end}

/* Main */
main{padding:22px 0 64px}
.panel{
  background:linear-gradient(180deg,rgba(10,14,20,.92),rgba(10,14,20,.92)) padding-box;
  border:1px solid rgba(255,255,255,.10);
  border-radius:18px;padding:18px;box-shadow:0 10px 32px rgba(0,0,0,.35)
}
.caption{color:var(--muted);font-size:14px;margin-bottom:10px}

/* Subnav like badges */
.subnav{display:flex;gap:8px;margin-bottom:12px}
.subnav .pill{height:36px;padding:0 14px;border-radius:999px;background:#0F1723;border-color:#233046}
.subnav .pill.active{background:var(--accent);color:#2A1800}

/* Standings table */
.table{width:100%;border-collapse:collapse}
.table thead th{
  font-size:14px;text-align:left;padding:12px 10px;color:#DDE8F8;border-bottom:1px solid rgba(255,255,255,.08)
}
.table tbody td{padding:16px 10px;border-bottom:1px solid rgba(255,255,255,.06);font-size:15px}
.table .pos{width:40px;font-weight:800;color:#fff}
.team{display:flex;align-items:center;gap:12px}
.logo{width:48px;height:48px;border-radius:12px;object-fit:cover;background:#0a0f16;border:1px solid rgba(255,255,255,.14)}
.row-top{background:linear-gradient(0deg,rgba(0,0,0,.12),rgba(0,0,0,.12)), linear-gradient(90deg,var(--gold1),var(--gold2))}
.row-regular{background:rgba(255,255,255,.02)}

/* Live */
.live{display:grid;grid-template-columns:1fr 200px 1fr;gap:16px;align-items:center}
.side{position:relative;background:#0E1520;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:18px;overflow:hidden}
.side::before{
  content:"";position:absolute;inset:0;
  background:radial-gradient(100% 100% at 0% 0%,rgba(255,255,255,.05),transparent 60%),
             radial-gradient(100% 100% at 100% 100%,rgba(255,255,255,.04),transparent 60%);
  pointer-events:none
}
.side .bar{
  display:flex;align-items:center;gap:12px;
  background:linear-gradient(90deg,rgba(255,255,255,.08),rgba(255,255,255,.04));
  padding:12px 14px;border-radius:12px
}
.side .name{font-weight:800;font-size:22px;letter-spacing:.2px}
.scorebox{background:#0E1520;border:1px solid rgba(255,255,255,.12);border-radius:16px;text-align:center;padding:16px}
.score{font-size:64px;line-height:1;font-weight:800}
.badge{display:inline-block;margin:6px 0;padding:6px 12px;border-radius:999px;background:#112031;border:1px solid #203047;font-weight:800}
.time{display:inline-block;margin-top:8px;padding:8px 14px;border-radius:999px;background:#101C2C;border:1px solid #233246;font-weight:800}
.ctrls{display:flex;gap:10px;justify-content:center;margin-top:10px}
.ctrls button{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:#122034;color:var(--ink);font-weight:800;cursor:pointer}
button.primary{background:var(--accent);color:#2A1800;border:none}
.small{font-size:12px;color:var(--muted)}
.select, select{background:#0F1C2B;color:var(--ink);border:1px solid #213049;border-radius:10px;padding:10px 12px;font-weight:600}

/* Finished cards */
.list{display:grid;gap:10px}
.card{display:grid;grid-template-columns:1fr 90px 1fr;align-items:center;gap:10px;background:#0E1520;border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:10px 12px}
.sidecell{display:flex;align-items:center;gap:10px;font-weight:800}
.sidecell img{width:32px;height:32px;border-radius:8px;border:1px solid rgba(255,255,255,.12)}
.center{font-weight:900;font-size:22px;text-align:center}

/* Bracket */
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
.bucket{background:#0E1520;border:1px solid rgba(255,255,255,.10);border-radius:16px;padding:12px}
.bucket h3{margin:0 0 10px}
.pair{display:flex;align-items:center;justify-content:space-between;gap:8px;background:#0F1928;border:1px solid rgba(255,255,255,.10);border-radius:12px;padding:8px 10px;margin-bottom:8px}
.pair .left,.pair .right{display:flex;align-items:center;gap:8px}
.pair img{width:26px;height:26px;border-radius:6px;border:1px solid rgba(255,255,255,.14)}
.pair .s{font-weight:900}

/* Hide admin bits by default */
.admin-only{display:none}
.admin-on .admin-only{display:block}
</style>
</head>
<body>
<header class="head">
  <div class="container head-grid">
    <div class="event">
      <img id="eventLogo" class="event-logo" alt="logo"/>
      <h1 id="leagueTitle" class="title">Ligue Hexa – V8.20</h1>
    </div>
    <nav id="mainNav" class="nav">
      <button class="pill" data-tab="classement">Classement</button>
      <button class="pill" data-tab="live">Matchs en direct</button>
      <button class="pill" data-tab="finished">Matchs terminés</button>
      <button class="pill" data-tab="manage">Gestion</button>
    </nav>
    <button id="adminBtn" class="pill admin" title="Mode admin">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px">
        <path d="M12 17a2 2 0 0 0 2-2V9a2 2 0 1 0-4 0v6a2 2 0 0 0 2 2z"/><path d="M7 9V7a5 5 0 1 1 10 0v2"/><rect x="5" y="9" width="14" height="10" rx="2"/>
      </svg>
      Admin
    </button>
  </div>
</header>

<main class="container">
  <!-- CLASSEMENT -->
  <section id="tab-classement" class="panel" hidden>
    <div class="caption">Tri : Points ▸ Diff ▸ BO ▸ BD ▸ Confrontation directe.</div>
    <div class="subnav">
      <button class="pill sub" data-sub="tableau">Classement</button>
      <button class="pill sub" data-sub="bracket">Phase finale</button>
      <button class="pill sub" data-sub="buteurs">Buteurs</button>
    </div>

    <div id="view-tableau">
      <table class="table">
        <thead><tr>
          <th class="pos">#</th><th>Équipe</th><th>J</th><th>G</th><th>N</th><th>P</th><th>BP</th><th>BC</th><th>Diff</th><th>BO</th><th>BD</th><th>Pts</th>
        </tr></thead>
        <tbody id="standings"></tbody>
      </table>
    
    <div id="view-bracket" hidden>
      <div class="grid3">
        <div class="bucket"><h3>Barrages</h3><div id="barrages"></div></div>
        <div class="bucket"><h3>Demi-finales</h3><div id="demis"></div></div>
        <div class="bucket"><h3>Finale</h3><div id="finale"></div></div>
      </div>
    </div>
</div>

    <div id="view-buteurs" hidden>
      <table class="table">
        <thead><tr><th class="pos">#</th><th>Joueur</th><th>Club</th><th>Buts</th></tr></thead>
        <tbody id="scorers"></tbody>
      </table>
    </div>
  </section>

  <!-- LIVE -->
  <section id="tab-live" class="panel" hidden>
    <div class="live">
      <div class="side">
        <div class="bar"><img id="aLogo" class="logo"><div class="name" id="aName">—</div></div>
        <div class="admin-only" style="margin-top:10px">
          <label class="small">Équipe A</label>
          <select id="aSelect" class="select"></select>
          <div style="height:8px"></div>
          <label class="small">Buteur</label>
          <select id="aPlayer" class="select"></select>
          <button id="aPlus" class="primary" style="margin-left:8px">+1</button>
          <button id="aMoins">-1</button>
          <div id="aLog" class="small"></div>
        </div>
      </div>

      <div class="scorebox">
        <div class="badge">EN DIRECT</div>
        <div class="score"><span id="as">0</span> – <span id="bs">0</span></div>
        <div class="time" id="timer">00:00</div>
        <div class="ctrls admin-only">
          <button id="play">▶</button><button id="pause">⏸</button><button id="reset">↺</button>
        </div>
        <div class="ctrls admin-only">
          <button id="finish" class="primary">Match terminé</button>
          <button id="swap">Inverser</button>
        </div>
        <div class="small" id="matchId">ID —</div>
      </div>

      <div class="side">
        <div class="bar"><div class="name" id="bName">—</div><img id="bLogo" class="logo"></div>
        <div class="admin-only" style="margin-top:10px">
          <label class="small">Équipe B</label>
          <select id="bSelect" class="select"></select>
          <div style="height:8px"></div>
          <label class="small">Buteur</label>
          <select id="bPlayer" class="select"></select>
          <button id="bPlus" class="primary" style="margin-left:8px">+1</button>
          <button id="bMoins">-1</button>
          <div id="bLog" class="small"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- FINISHED -->
  <section id="tab-finished" class="panel" hidden>
    <div id="finished" class="list"></div>
  </section>

<!-- GESTION -->
  <section id="tab-manage" class="panel" hidden>
    <h3>Gestion</h3>
    <p class="small">LocalStorage uniquement. Vous pouvez remettre à zéro ci-dessous.</p>
    <button id="wipe" class="primary">Ré-initialiser les données</button>
  </section>
</main>

<!-- Embedded teams fallback -->
<script id="teams-json" type="application/json">{
  "leagueName": "National League of Skullball",
  "eventLogo": "logos/logoevent.png",
  "teams": [
    {
      "id": 1,
      "name": "Le Hollandais Violent",
      "logo": "logos/equipe1.png",
      "color": "#202532",
      "players": ["Sheppard", "Etagon", "Kz", "Lama", "Sqyze", "Skyllocks"]
    },
    {
      "id": 2,
      "name": "Aviron Bayonnais",
      "logo": "logos/equipe2.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    },
    {
      "id": 3,
      "name": "Castres Olympique",
      "logo": "logos/equipe3.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    },
    {
      "id": 4,
      "name": "Provence Rugby",
      "logo": "logos/equipe4.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    },
    {
      "id": 5,
      "name": "RC Toulon",
      "logo": "logos/equipe5.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    },
    {
      "id": 6,
      "name": "RC Vannes",
      "logo": "logos/equipe6.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    },
    {
      "id": 7,
      "name": "Section Paloise",
      "logo": "logos/equipe7.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    },
    {
      "id": 8,
      "name": "Stade Toulousain",
      "logo": "logos/equipe8.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    },
    {
      "id": 9,
      "name": "Stade Rochelais",
      "logo": "logos/equipe9.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    },
    {
      "id": 10,
      "name": "Perpignan",
      "logo": "logos/equipe10.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    },
    {
      "id": 11,
      "name": "Nevers",
      "logo": "logos/equipe11.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    },
    {
      "id": 12,
      "name": "US Montauban",
      "logo": "logos/equipe12.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    },
    {
      "id": 13,
      "name": "Union Bordeaux Bègles",
      "logo": "logos/equipe13.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    },
    {
      "id": 14,
      "name": "Lyon OU",
      "logo": "logos/equipe14.png",
      "color": "#202532",
      "players": ["Joueur 1", "Joueur 2", "Joueur 3", "Joueur 4", "Joueur 5", "Joueur 6"]
    }
  ]
}

</script>

<script>
/* -------- Config -------- */
const DATA_URL = ""; // mettre l'URL raw GitHub de teams.json si besoin

/* -------- State -------- */
let TEAMS = [];
let STATS = {};
let FINISHED = JSON.parse(localStorage.getItem("sk_v820_finished")||"[]");
let ADMIN = false;
let cur = { a:null,b:null,as:0,bs:0,events:[],running:false,start:0,elapsed:0,id:rid() };

/* -------- Utils -------- */
const $ = (sel,ctx=document)=>ctx.querySelector(sel);
const $$ = (sel,ctx=document)=>Array.from(ctx.querySelectorAll(sel));
function rid(){ return Math.random().toString(36).slice(2,8); }
function fmt(s){ const m=String(Math.floor(s/60)).padStart(2,"0"); const z=String(Math.floor(s%60)).padStart(2,"0"); return m+':'+z; }
function T(id){ return TEAMS.find(t=>t.id==id); }

/* -------- Load teams -------- */
async function loadTeams(){
  let data;
  if(DATA_URL){
    try{ const r=await fetch(DATA_URL,{cache:"no-store"}); data=await r.json(); }catch(e){}
  }
  if(!data){
    try{ const r2=await fetch("teams.json",{cache:"no-store"}); if(r2.ok) data=await r2.json(); }catch(e){}
  }
  if(!data){ data = JSON.parse($("#teams-json").textContent); }
  TEAMS = data.teams||[];
  $("#leagueTitle").textContent = data.leagueName || "Ligue Hexa – V8.20";
  if(data.eventLogo) $("#eventLogo").src = data.eventLogo;

  // init stats
  STATS={};
  TEAMS.forEach(t=> STATS[t.id]={J:0,G:0,N:0,P:0,BP:0,BC:0,Diff:0,BO:0,BD:0,Pts:0});

  // populate selects
  const opt = TEAMS.map(t=>`<option value="${t.id}">${t.name}</option>`).join("");
  $("#aSelect").innerHTML = "<option value=''>—</option>"+opt;
  $("#bSelect").innerHTML = "<option value=''>—</option>"+opt;

  // defaults
  if(!cur.a && TEAMS.length>1){ setTeam("a", TEAMS[0].id); setTeam("b", TEAMS[1].id); }

  renderStandings(); renderBracket(); renderFinished();
}

/* -------- Tabs -------- */
function showTab(key){
  $$("#mainNav .pill").forEach(p=> p.classList.toggle("active", p.dataset.tab===key));
  $$("main > section").forEach(s=> s.hidden = !s.id.endsWith(key));
  localStorage.setItem("sk_v820_tab", key);
  if(key==="classement"){ showSub(localStorage.getItem("sk_v820_sub")||"tableau"); }
}
function showSub(k){
  $$(".subnav .pill").forEach(p=> p.classList.toggle("active", p.dataset.sub===k));
  $("#view-tableau").hidden = k!=="tableau";
  $("#view-bracket").hidden = k!=="bracket";
  $("#view-buteurs").hidden = k!=="buteurs";
  localStorage.setItem("sk_v820_sub", k);
}
document.addEventListener("click",(e)=>{
  const t=e.target.closest(".pill");
  if(t && t.dataset.tab){ showTab(t.dataset.tab); }
  const s=e.target.closest(".pill.sub");
  if(s && s.dataset.sub){ showSub(s.dataset.sub); }
});

/* -------- Admin -------- */
$("#adminBtn").addEventListener("click", ()=>{
  ADMIN=!ADMIN; document.body.classList.toggle("admin-on", ADMIN);
  $("#adminBtn").classList.toggle("active", ADMIN);
});

/* -------- Live -------- */
function setTeam(side, id){
  id=Number(id); if(!id) return;
  if(side==="a"){
    cur.a=id; $("#aName").textContent=T(id)?.name||"—"; $("#aLogo").src=T(id)?.logo||"";
    $("#aPlayer").innerHTML=(T(id)?.players||[]).map(p=>`<option value="${p}">${p}</option>`).join("");
  } else {
    cur.b=id; $("#bName").textContent=T(id)?.name||"—"; $("#bLogo").src=T(id)?.logo||"";
    $("#bPlayer").innerHTML=(T(id)?.players||[]).map(p=>`<option value="${p}">${p}</option>`).join("");
  }
}
$("#aSelect").addEventListener("change",(e)=>setTeam("a",e.target.value));
$("#bSelect").addEventListener("change",(e)=>setTeam("b",e.target.value));
$("#swap").addEventListener("click",()=>{ const a=cur.a,b=cur.b; setTeam("a",b); setTeam("b",a); });

function tick(){ cur.elapsed = Date.now()-cur.start; $("#timer").textContent = fmt(cur.elapsed/1000); }
let it=null;
$("#play").addEventListener("click",()=>{ if(cur.running) return; cur.running=true; cur.start=Date.now()-(cur.elapsed||0); it=setInterval(tick,250); });
$("#pause").addEventListener("click",()=>{ if(it) clearInterval(it); it=null; cur.running=false; });
$("#reset").addEventListener("click",()=>{ if(it) clearInterval(it); it=null; cur.running=false; cur.elapsed=0; $("#timer").textContent="00:00"; });

function goal(side,delta){
  if(side==="a"){ cur.as=Math.max(0,cur.as+delta); $("#as").textContent=cur.as; if(delta>0){ const p=$("#aPlayer").value||"?"; $("#aLog").textContent += ` + ${p} (${fmt((cur.elapsed||0)/1000)})`; } }
  else { cur.bs=Math.max(0,cur.bs+delta); $("#bs").textContent=cur.bs; if(delta>0){ const p=$("#bPlayer").value||"?"; $("#bLog").textContent += ` + ${p} (${fmt((cur.elapsed||0)/1000)})`; } }
}
$("#aPlus").addEventListener("click",()=>goal("a",+1)); $("#aMoins").addEventListener("click",()=>goal("a",-1));
$("#bPlus").addEventListener("click",()=>goal("b",+1)); $("#bMoins").addEventListener("click",()=>goal("b",-1));

$("#finish").addEventListener("click",()=>{
  if(!(cur.a&&cur.b)) return alert("Sélectionner les deux équipes.");
  if(it) clearInterval(it); it=null; cur.running=false;
  const m={id:cur.id,a:cur.a,b:cur.b,ga:cur.as,gb:cur.bs,events:cur.events||[],ts:Date.now(),elapsed:Math.floor((cur.elapsed||0)/1000)};
  FINISHED.push(m);
  localStorage.setItem("sk_v820_finished", JSON.stringify(FINISHED));
  // stats 3/1/0
  const A=STATS[m.a], B=STATS[m.b];
  A.J++; B.J++; A.BP+=m.ga; A.BC+=m.gb; B.BP+=m.gb; B.BC+=m.ga; A.Diff=A.BP-A.BC; B.Diff=B.BP-B.BC;
  if(m.ga>m.gb){ A.G++; B.P++; A.Pts+=3; } else if(m.gb>m.ga){ B.G++; A.P++; B.Pts+=3; } else { A.N++; B.N++; A.Pts++; B.Pts++; }
  renderStandings(); renderFinished(); renderBracket();
  // reset id & score
  cur = { a:cur.a,b:cur.b,as:0,bs:0,events:[],running:false,start:0,elapsed:0,id:rid() };
  $("#as").textContent="0"; $("#bs").textContent="0"; $("#aLog").textContent=""; $("#bLog").textContent="";
  $("#matchId").textContent = "ID "+cur.id;
  $("#timer").textContent="00:00";
  alert("Match archivé.");
});
$("#matchId").textContent = "ID "+cur.id;

/* -------- Standings & scorers -------- */
function renderStandings(){
  const rows = Object.entries(STATS).map(([id,s])=>({id:Number(id),...s,name:T(id)?.name||"?",logo:T(id)?.logo||""}));
  rows.sort((a,b)=> b.Pts-a.Pts || b.Diff-a.Diff || b.BP-a.BP || a.name.localeCompare(b.name));
  const body=$("#standings"); body.innerHTML="";
  rows.forEach((r,i)=>{
    const tr=document.createElement("tr");
    tr.className = i<6 ? "row-top" : "row-regular";
    tr.innerHTML=`
      <td class="pos">${i+1}</td>
      <td><div class="team"><img class="logo" src="${r.logo}" alt=""><div>${r.name}</div></div></td>
      <td>${r.J}</td><td>${r.G}</td><td>${r.N}</td><td>${r.P}</td>
      <td>${r.BP}</td><td>${r.BC}</td><td>${r.Diff}</td><td>${r.BO}</td><td>${r.BD}</td><td><strong>${r.Pts}</strong></td>`;
    body.appendChild(tr);
  });

  // scorers from FINISHED
  const counts=new Map();
  FINISHED.forEach(m=> (m.events||[]).forEach(ev=>{
    const tid = ev.side==="A"? m.a : m.b;
    const key = (ev.player||"?")+"||"+(T(tid)?.name||"?");
    counts.set(key,(counts.get(key)||0)+1);
  }));
  const arr=[...counts.entries()].map(([k,v])=>{const [p,c]=k.split("||");return {p,c,g:v};}).sort((a,b)=> b.g-a.g || a.p.localeCompare(b.p));
  const sb=$("#scorers"); sb.innerHTML="";
  arr.forEach((x,idx)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td class="pos">${idx+1}</td><td>${x.p}</td><td>${x.c}</td><td><strong>${x.g}</strong></td>`;
    sb.appendChild(tr);
  });
}

/* -------- Finished list -------- */
function renderFinished(){
  const box=$("#finished"); box.innerHTML="";
  FINISHED.slice().reverse().forEach(m=>{
    const a=T(m.a)||{name:"?",logo:""}, b=T(m.b)||{name:"?",logo:""};
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`<div class="sidecell"><img src="${a.logo}"><span>${a.name}</span></div>
                 <div class="center">${m.ga} – ${m.gb}</div>
                 <div class="sidecell" style="justify-content:end"><span>${b.name}</span><img src="${b.logo}"></div>`;
    box.appendChild(d);
  });
}

/* -------- Bracket (placeholder) -------- */
function renderBracket(){
  const rows = Object.entries(STATS).map(([id,s])=>({id:Number(id),...s,name:T(id)?.name||"?",logo:T(id)?.logo||""}));
  rows.sort((a,b)=> b.Pts-a.Pts || b.Diff-a.Diff || b.BP-a.BP || a.name.localeCompare(b.name));
  const top8=rows.slice(0,8);
  const mk=(l,r)=>`<div class="pair"><div class="left"><img src="${l.logo}"><span>${l.name}</span></div><div class="s">0</div><div class="right"><span>${r.name}</span><img src="${r.logo}"></div></div>`;
  $("#barrages").innerHTML = top8.length>=8 ? mk(top8[0],top8[7]) + mk(top8[3],top8[4]) : '<div class="small">Définir les équipes…</div>';
  $("#demis").innerHTML    = top8.length>=8 ? mk(top8[1],top8[6]) + mk(top8[2],top8[5]) : '<div class="small">Définir les équipes…</div>';
  const f1=rows[0]||{logo:"",name:"—"}, f2=rows[1]||{logo:"",name:"—"};
  $("#finale").innerHTML = mk(f1,f2);
}

/* -------- Manage -------- */
$("#wipe").addEventListener("click",()=>{
  if(!confirm("Tout ré-initialiser ?")) return;
  FINISHED=[]; localStorage.removeItem("sk_v820_finished");
  Object.keys(STATS).forEach(id=> STATS[id]={J:0,G:0,N:0,P:0,BP:0,BC:0,Diff:0,BO:0,BD:0,Pts:0});
  renderStandings(); renderFinished(); renderBracket();
});

/* -------- Boot -------- */
$$("#mainNav .pill").forEach(b=> b.addEventListener("click",()=>showTab(b.dataset.tab)));
function boot(){
  const saved = localStorage.getItem("sk_v820_tab");
  const valid = ["classement","live","finished","manage"];
  showTab(valid.includes(saved)? saved : "classement");
  showSub(localStorage.getItem("sk_v820_sub")||"tableau");
  loadTeams();
}
boot();
</script>
</body>
</html>
