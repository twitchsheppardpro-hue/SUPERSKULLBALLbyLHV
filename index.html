<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tournoi — Classement (runtime GitHub)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0d14;
  --panel:#141826;
  --panel-2:#101524;
  --text:#eaf0ff;
  --muted:#a6b0c6;
  --line:#242c3f;
  --accent:#ffb100;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:radial-gradient(1200px 600px at 15% -10%, rgba(255,177,0,.06), transparent 60%), linear-gradient(135deg, #0b0d14, #111629 58%, #0b0f1d);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif}
header{position:sticky;top:0;z-index:20;background:linear-gradient(90deg, rgba(255,177,0,.12), rgba(255,177,0,.05) 35%, transparent);border-bottom:1px solid var(--line);backdrop-filter:blur(6px)}
.wrap{max-width:1200px;margin:0 auto;padding:16px}
.tabs{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.tab{padding:12px 16px;border-radius:12px;background:var(--panel);border:1px solid var(--line);color:var(--text);cursor:pointer;transition:.2s;font-weight:800}
.tab[aria-selected="true"], .tab:hover{background:linear-gradient(135deg,#1b2032,#161c2b);border-color:#2d3650}
.public-pill{margin-left:auto;padding:8px 12px;border-radius:999px;border:1px solid var(--line);color:var(--muted);background:#0f1424;font-size:12px}
main.wrap{padding-top:18px}
.panel{background:linear-gradient(180deg,#141a2a,#0f1423);border:1px solid var(--line);border-radius:16px;padding:18px}
.league{display:flex;align-items:center;gap:16px;margin-bottom:8px}
.league .logo{width:96px;height:96px;border-radius:14px;border:2px solid #2b334c;background:#0d1120;object-fit:cover}
.league .name{font-size:34px;font-weight:900}
.actions{margin-left:auto}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;background:#182038;border:1px solid var(--line);color:var(--text);cursor:pointer;font-weight:700}
.btn:hover{background:#1c2441}
h2{margin:6px 0 12px 0;font-size:22px}
.sub{color:var(--muted);font-size:13px;margin:6px 0 10px}
.table-wrap{overflow:auto;border-radius:12px;border:1px solid var(--line)}
table{width:100%;border-collapse:collapse;font-size:16px}
thead th{position:sticky;top:0;background:#161d31;z-index:1}
th,td{padding:14px 12px;border-bottom:1px solid var(--line);text-align:left}
tbody tr:hover{background:#121a30}
.rank{width:56px;text-align:center;font-weight:900}
.team{display:flex;align-items:center;gap:12px;font-weight:800}
.team img{width:40px;height:40px;border-radius:8px;border:1px solid #2b3550;background:#0d1120;object-fit:cover}
.pts{font-weight:1000}
/* highlights (sobre) */
tbody tr:nth-child(-n+2){background:linear-gradient(90deg, rgba(46,125,50,.12), rgba(56,142,60,.18))}
tbody tr:nth-child(n+3):nth-child(-n+6){background:linear-gradient(90deg, rgba(230,140,0,.12), rgba(255,160,0,.18))}
.note{color:var(--muted);font-size:12px;margin-top:8px}
.hidden{display:none !important}
/* Prevent any watermark/duplicate titles behind rows */
.bg-watermark{display:none !important}
</style>
</head>
<body>
<header>
  <div class="wrap tabs" role="tablist">
    <button class="tab" aria-selected="true" data-tab="standings">Classement</button>
    <button class="tab" aria-selected="false" data-tab="live">Matchs en direct</button>
    <button class="tab" aria-selected="false" data-tab="finished">Matchs terminés</button>
    <button class="tab" aria-selected="false" data-tab="knockout">Phase finale</button>
    <button class="tab" aria-selected="false" data-tab="admin">Gestion</button>
    <span id="publicPill" class="public-pill">chargé depuis <code>data/teams.json</code></span>
  </div>
</header>

<main class="wrap">
  <section id="tab-standings" class="panel">
    <div class="league">
      <img id="leagueLogo" alt="logo" class="logo" src="">
      <div class="name" id="leagueName">Ma Ligue</div>
      <div class="actions">
        <button id="reloadBtn" class="btn">Recharger (no‑cache)</button>
      </div>
    </div>
    <div class="sub" id="subtitle">Tri : Points ▶︎ Diff ▶︎ BO ▶︎ BD ▶︎ Confrontation directe.</div>
    <div class="table-wrap">
      <table id="standings">
        <thead><tr>
          <th class="rank">#</th><th>Équipe</th><th>J</th><th>G</th><th>N</th><th>P</th>
          <th>BP</th><th>BC</th><th>Diff</th><th>BO</th><th>BD</th><th class="pts">Pts</th>
        </tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
    <div class="note">Aucun match joué pour l’instant : classement alphabétique (démo visuelle).</div>
  </section>

  <section id="tab-live" class="panel hidden"><h2>Matchs en direct</h2><div class="sub">Aucun</div></section>
  <section id="tab-finished" class="panel hidden"><h2>Matchs terminés</h2><div class="sub">Aucun</div></section>
  <section id="tab-knockout" class="panel hidden"><h2>Phase finale</h2><div class="sub">À générer depuis la Gestion (hors public)</div></section>
  <section id="tab-admin" class="panel hidden"><h2>Gestion</h2><div class="sub">Masquée en mode public (lecture seule) — les blocs Équipes/Joueurs ont été retirés.</div></section>
</main>

<script>
const GITHUB_JSON = (function(){
  // Essayons d'utiliser le même domaine/chemin que la page est servie.
  try{
    const base = new URL(window.location.href);
    base.pathname = base.pathname.replace(/index\.html?$/,'').replace(/\/$/,'') + '/data/teams.json';
    return base.toString();
  }catch(_){ return './data/teams.json'; }
})();

const state = { league:{name:'Ma Ligue', logo:''}, teams:[] };

function el(id){ return document.getElementById(id); }

function renderTable(){
  const tbody = el('tbody');
  const rows = (state.teams||[]).slice().sort((a,b)=> a.name.localeCompare(b.name));
  tbody.innerHTML = rows.map((t,i)=>{
    const logo = t.logo ? `<img src="${t.logo}" alt="">` : '<span style="width:40px;height:40px;display:inline-block;border-radius:8px;border:1px solid #2b3550;background:#0d1120"></span>';
    const name = escapeHtml(t.name||('équipe'+(i+1)));
    return `<tr>
      <td class="rank">${i+1}</td>
      <td><div class="team">${logo}<span>${name}</span></div></td>
      <td>0</td><td>0</td><td>0</td><td>0</td>
      <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td class="pts">0</td>
    </tr>`;
  }).join('');
}

function escapeHtml(s){ return (s||'').replace(/[&<>\"']/g, m => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[m])) }

async function loadJson(noCache=false){
  const url = new URL(GITHUB_JSON, window.location.href);
  if(noCache){ url.searchParams.set('_', Date.now()); }
  let data;
  try{
    const res = await fetch(url.toString(), {cache: noCache ? 'reload':'default'});
    data = await res.json();
  }catch(e){
    console.warn('Échec chargement JSON, tentative fallback ./data/teams.json', e);
    const res = await fetch('./data/teams.json?_'+Date.now());
    data = await res.json();
  }
  // mapping attendu: { leagueName, eventLogo, teams:[{id,name,logo,color,players:[]}] }
  state.league.name = data.leagueName || 'Ma Ligue';
  state.league.logo = data.eventLogo || '';
  state.teams = (data.teams||[]).map(t => ({
    id: t.id || String(Math.random()).slice(2,9),
    name: t.name || 'équipe',
    logo: (t.logo||'').startsWith('http') || (t.logo||'').startsWith('data:') ? t.logo : (t.logo || ''),
    color: t.color || '#202532',
    players: Array.isArray(t.players) ? t.players.slice(0,6) : []
  }));
  renderHeader();
  renderTable();
}

function renderHeader(){
  el('leagueName').textContent = state.league.name || 'Ma Ligue';
  const lg = el('leagueLogo');
  lg.src = state.league.logo || '';
  lg.style.display = state.league.logo ? 'block':'none';
}

document.getElementById('reloadBtn').addEventListener('click', ()=> loadJson(true));

// tabs (visuels uniquement)
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    const target = btn.dataset.tab;
    document.querySelectorAll('main section.panel').forEach(sec=>sec.classList.add('hidden'));
    document.getElementById('tab-'+target).classList.remove('hidden');
  });
});

// initial
loadJson(true);
</script>
</body>
</html>
