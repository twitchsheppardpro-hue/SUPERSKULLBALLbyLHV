<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Skullball — Ligues & Équipes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0e1116;
      --panel:#151923;
      --muted:#8b93a7;
      --text:#e7ecf3;
      --accent:#ff7a1a;
      --ring:#2a3142;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      background:radial-gradient(1200px 800px at -10% -20%, #1b2130 0%, transparent 60%),
                 radial-gradient(900px 600px at 120% -10%, #1a2131 0%, transparent 55%),
                 var(--bg);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .wrap{max-width:1200px;margin-inline:auto;padding:28px;display:flex;flex-direction:column;gap:24px}
    header{
      display:flex;align-items:center;gap:18px;flex-wrap:wrap;
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid var(--ring);border-radius:14px;padding:14px 16px 14px 14px;
      box-shadow:0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.03);
    }
    header img{
      width:64px;height:64px;object-fit:cover;border-radius:12px;border:1px solid var(--ring);
      background:#0a0d13;
    }
    .h-txt{display:flex;flex-direction:column;gap:4px}
    .league{font-weight:800;font-size:1.4rem;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:.95rem}

    .teams{
      display:grid;grid-template-columns:repeat(12,minmax(0,1fr));gap:16px
    }
    @media (max-width:1200px){.teams{grid-template-columns:repeat(9,1fr)}}
    @media (max-width:992px){.teams{grid-template-columns:repeat(6,1fr)}}
    @media (max-width:680px){.teams{grid-template-columns:repeat(2,1fr)}}

    .card{
      grid-column:span 4;
      background:var(--panel);border:1px solid var(--ring);
      border-radius:14px;overflow:hidden;position:relative;
      transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
      box-shadow:0 8px 24px rgba(0,0,0,.25);
      isolation:isolate;
    }
    .card:hover{transform:translateY(-3px);border-color:#334059}
    .banner{
      height:84px;background:#1a1f2a;position:relative;overflow:hidden
    }
    .banner::after{
      content:"";position:absolute;inset:0;pointer-events:none;mix-blend:screen;
      background:radial-gradient(600px 120px at 10% 0%, rgba(255,255,255,.15), transparent 60%),
                 radial-gradient(400px 120px at 90% 0%, rgba(255,255,255,.08), transparent 60%);
    }
    .logo{
      width:64px;height:64px;border-radius:12px;border:1px solid var(--ring);
      position:absolute;left:14px;top:52px;transform:translateY(-50%);background:#0d1118;object-fit:cover
    }
    .content{padding:54px 14px 14px 14px;display:flex;flex-direction:column;gap:8px}
    .name{font-weight:700;letter-spacing:.2px}
    .players{display:flex;flex-wrap:wrap;gap:8px}
    .tag{
      padding:6px 10px;border:1px solid var(--ring);border-radius:10px;background:#0e1320;
      color:var(--muted);font-size:.9rem
    }
    .footer{
      margin-top:auto;display:flex;justify-content:flex-end;padding-top:8px;color:var(--muted);
      font-size:.85rem
    }
    .muted{color:var(--muted)}
    .hidden{display:none}
    .error{
      border:1px dashed #a33;background:#2a1313;color:#ffbdbd;padding:12px;border-radius:10px
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img id="eventLogo" alt="Logo event" />
      <div class="h-txt">
        <div class="league" id="leagueName">Ma Ligue</div>
        <div class="sub">Aperçu public – équipes & joueurs (JSON)</div>
      </div>
    </header>

    <div id="errorBox" class="error hidden"></div>

    <section class="teams" id="teamsGrid" aria-live="polite"></section>

    <footer class="muted" style="text-align:center;margin-top:10px">
      Chargé depuis <code>/data/teams.json</code> – Images depuis <code>/logos/…</code>
    </footer>
  </div>

  <script>
  (function () {
    const grid = document.getElementById('teamsGrid');
    const leagueNameEl = document.getElementById('leagueName');
    const eventLogoEl = document.getElementById('eventLogo');
    const errorBox = document.getElementById('errorBox');

    const TEAMS_URL = 'data/teams.json?v=' + Date.now(); // anti-cache soft

    function showError(msg){
      errorBox.textContent = 'Erreur: ' + msg;
      errorBox.classList.remove('hidden');
    }

    function safeColor(hex, fallback='#202532'){
      if(typeof hex !== 'string') return fallback;
      const ok = /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(hex.trim());
      return ok ? hex.trim() : fallback;
    }

    function teamCard(team){
      const color = safeColor(team.color || '#202532');

      const card = document.createElement('article');
      card.className = 'card';

      const banner = document.createElement('div');
      banner.className = 'banner';
      banner.style.background = `linear-gradient(180deg, ${color} 0%, rgba(0,0,0,.25) 100%)`;
      card.appendChild(banner);

      const logo = document.createElement('img');
      logo.className = 'logo';
      logo.alt = team.name || 'Équipe';
      logo.src = team.logo || '';
      logo.onerror = () => {
        logo.src = 'data:image/svg+xml;utf8,' +
          encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256">
            <rect width="100%" height="100%" fill="#0d1118"/>
            <text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle" fill="#334059"
                  font-family="Inter, Arial" font-size="32" font-weight="700">LOGO</text>
          </svg>`);
      };
      card.appendChild(logo);

      const content = document.createElement('div');
      content.className = 'content';

      const name = document.createElement('div');
      name.className = 'name';
      name.textContent = team.name || 'Équipe';
      content.appendChild(name);

      const players = document.createElement('div');
      players.className = 'players';
      (team.players || []).forEach(p=>{
        const tag = document.createElement('div');
        tag.className = 'tag';
        tag.textContent = p;
        players.appendChild(tag);
      });
      content.appendChild(players);

      const foot = document.createElement('div');
      foot.className = 'footer';
      foot.innerHTML = `<span class="muted">ID&nbsp;#${team.id ?? '–'}</span>`;
      content.appendChild(foot);

      card.appendChild(content);
      return card;
    }

    function applyHeader(data){
      leagueNameEl.textContent = data.leagueName || 'Ma Ligue';
      const src = data.eventLogo || '';
      if(src){
        eventLogoEl.src = src;
        eventLogoEl.onerror = () => {
          eventLogoEl.classList.add('hidden');
        };
      }else{
        eventLogoEl.classList.add('hidden');
      }
    }

    async function boot(){
      try{
        const res = await fetch(TEAMS_URL, {cache:'no-cache'});
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        applyHeader(data);

        const teams = Array.isArray(data.teams) ? data.teams : [];
        if(teams.length === 0){
          showError('Aucune équipe trouvée dans data/teams.json');
          return;
        }

        // Tri par id croissant pour un rendu stable
        teams.sort((a,b)=> (a.id||0) - (b.id||0));

        const frag = document.createDocumentFragment();
        teams.forEach(t => frag.appendChild(teamCard(t)));
        grid.innerHTML = '';
        grid.appendChild(frag);
      }catch(e){
        console.error(e);
        showError(e.message || 'Chargement impossible');
      }
    }

    boot();
  })();
  </script>
</body>
</html>
